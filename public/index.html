<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vidyaayaanam ‚Äì Syllabus Content Generator</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Minimalist Modern Styling */
        body { 
            background: #f8f9fa; /* Light, neutral background */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; /* Clean, modern font stack */
        }
        .card { 
            border-radius: 12px;
            box-shadow: none; /* Remove heavy shadows */
            border: 1px solid #e0e0e0; /* Subtle border */
        }
        .top-header h2 {
            font-weight: 700;
            color: #333;
        }
        .pill-btn {
            padding: 8px 16px;
            border-radius: 6px; /* Slightly squarer than a pill */
            border: 1px solid #ccc;
            background: #fff;
            margin-right: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-size: 0.95rem;
        }
        .pill-active {
            background: #0d6efd;
            color: #fff;
            border-color: #0d6efd;
            box-shadow: 0 2px 4px rgba(13, 110, 253, 0.2);
        }
        .form-select, .form-control {
            border-radius: 6px;
        }
        .loading-spinner { 
            text-align: center; 
            padding: 30px; 
            color: #0d6efd; 
            font-size: 1.2rem;
            font-weight: 500;
        }
        #content-output {
            border: 1px solid #e0e0e0; /* Clean border for output box */
            border-radius: 6px;
            padding: 20px !important;
        }
    </style>
</head>

<body>

    <div class="top-header text-center mt-5 mb-4">
        <h2 style="font-weight:bold;">‡¥µ‡¥ø‡¥¶‡µç‡¥Ø‡¥æ‡¥Ø‡¥æ‡¥®‡¥Ç</h2>
        <p class="text-secondary">A Voyage Through Knowledge</p>
    </div>

    <div class="container mt-3">
        <div class="card p-4">

            <h5 class="mb-4 text-primary">Content Generation Settings</h5>

            <label class="mt-3"><b>1. Select Resource Type:</b></label>
            <div id="resource-type">
                <button class="pill-btn" data-type="Lesson Plan">Lesson Plan</button>
                <button class="pill-btn" data-type="Notes">Notes</button>
                <button class="pill-btn" data-type="Q & A">Q & A</button>
                <button class="pill-btn" data-type="Presentation Help">Presentation Help</button>
            </div>

            <label class="mt-4"><b>2. Select Medium / Language:</b></label>
            <div id="medium-type">
                <button class="pill-btn" data-med="Malayalam">Malayalam</button>
                <button class="pill-btn" data-med="English">English</button>
                <button class="pill-btn" data-med="Hindi">Hindi</button>
                <button class="pill-btn" data-med="Sanskrit">Sanskrit</button>
                <button class="pill-btn" data-med="Arabic">Arabic</button>
            </div>

            <label class="mt-4"><b>3. Select Class (Standard):</b></label>
            <select id="class-select" class="form-select"></select>

            <label class="mt-4"><b>4. Select Subject:</b></label>
            <select id="subject-select" class="form-select"></select>

            <label class="mt-4"><b>5. Select Topic / Chapter:</b></label>
            <select id="topic-select" class="form-select"></select>

            <div id="chapter-wrapper" class="mt-3">
                <label><b>6. Enter Specific Query / Chapter Name:</b></label>
                <input id="query-input" type="text" class="form-control" placeholder="E.g., What are the key points in this chapter?">
            </div>

            <button id="generate-btn" class="btn btn-primary mt-4 w-100 py-2">
                <i class="fas fa-magic me-2"></i> GENERATE CONTENT
            </button>

        </div>

        <div id="content-output" class="mt-4 p-3 bg-white" style="min-height:150px;">
            <p class="text-muted">Generated content will appear here.</p>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
       // ‚úÖ UPDATED: Netlify Function endpoint for your serverless backend!
const SERVER_URL = "/.netlify/functions/generate-content";
 
        
        //------------------------------
        // DROPDOWN DATA & REFERENCES
        //------------------------------
        const classList = ["1","2","3","4","5","6","7","8","9","10"];
        const subjectList = [
            "Malayalam","English","Hindi","Arabic","Sanskrit",
            "Mathematics","Science","Social Science","ICT",
            "Health & Physical Education","Art Education",
            "General Knowledge","Moral Science","Computer Science"
        ];
        
        const classSelect = document.getElementById("class-select");
        const subjectSelect = document.getElementById("subject-select");
        const topicSelect = document.getElementById("topic-select");
        const queryInput = document.getElementById("query-input");
        const contentOutput = document.getElementById("content-output");


        //------------------------------
        // LOAD CLASS DROPDOWN
        //------------------------------
        classSelect.innerHTML = '<option value="">Select Class...</option>';
        classList.forEach(c => {
            classSelect.innerHTML += `<option value="${c}">Class ${c}</option>`;
        });

        //------------------------------
        // LOAD SUBJECTS (on Class change)
        //------------------------------
        classSelect.addEventListener("change", () => {
            subjectSelect.innerHTML = '<option value="">Select Subject...</option>';
            subjectList.forEach(sub => {
                subjectSelect.innerHTML += `<option value="${sub}">${sub}</option>`;
            });
            topicSelect.innerHTML = '<option value="">Select Topic...</option>';
        });

        //------------------------------
        // LOAD TOPICS (on Subject change) - Dynamic 1-15 list
        //------------------------------
        subjectSelect.addEventListener("change", () => {
            let s = subjectSelect.value;
            topicSelect.innerHTML = '<option value="">Select Topic...</option>';

            const fixedTopicList = [];
            
            for (let i = 1; i <= 15; i++) {
                let topicName;
                
                if (s === "Hindi") {
                    topicName = `‡§™‡§æ‡§† ${i}`;
                } else if (s === "Arabic") {
                    topicName = `ÿßŸÑÿØÿ±ÿ≥ ${i}`;
                } else if (s === "Sanskrit") {
                    topicName = `‡§™‡§æ‡§†‡§É ${i}`;
                } else {
                    topicName = `Chapter ${i}`;
                }
                fixedTopicList.push(topicName);
            }
            
            fixedTopicList.forEach(t => {
                // Value sent to the backend includes the full context
                topicSelect.innerHTML += `<option value="${t} in ${s}">${t}</option>`;
            });
        });

        //------------------------------
        // TOGGLE BUTTON GROUPS
        //------------------------------
        function enablePills(containerId) {
            const container = document.getElementById(containerId);
            const btns = container.querySelectorAll(".pill-btn");

            btns.forEach(btn => {
                btn.addEventListener("click", () => {
                    btns.forEach(b => b.classList.remove("pill-active"));
                    btn.classList.add("pill-active");
                });
            });
        }

        enablePills("resource-type");
        enablePills("medium-type");

        //-----------------------------------------------------------------------------------------
        // üöÄ API INTEGRATION (FETCH CALL to your Node.js Proxy)
        //-----------------------------------------------------------------------------------------
        document.getElementById("generate-btn").addEventListener("click", generateContent);

        async function generateContent() {
            contentOutput.innerHTML = ''; 

            const resBtn = document.querySelector("#resource-type .pill-active");
            const medBtn = document.querySelector("#medium-type .pill-active");

            // 1. GATHER AND VALIDATE INPUTS
            const resourceType = resBtn ? resBtn.dataset.type : null;
            const medium = medBtn ? medBtn.dataset.med : null;
            const selectedClass = classSelect.value;
            const selectedSubject = subjectSelect.value;
            const selectedTopic = topicSelect.value;
            const userQuery = queryInput.value.trim();
            
            if (!resourceType || !medium || !selectedClass || !selectedSubject || !selectedTopic || !userQuery) {
                contentOutput.innerHTML = '<p class="text-danger">üõë Please ensure all fields and pills are selected, and a query is entered.</p>';
                return;
            }

            // 2. DISPLAY LOADING STATE
            contentOutput.innerHTML = `
                <div class="loading-spinner">
                    <i class="fas fa-sync-alt fa-spin"></i> Generating ${resourceType} for ${selectedSubject}... Please wait.
                </div>`;

            // 3. SECURELY CALL NODE.JS PROXY SERVER (via Fetch)
            try {
                const response = await fetch(SERVER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        resourceType, medium, selectedClass, selectedSubject, selectedTopic, userQuery
                    }),
                });

                const result = await response.json();

                // 4. DISPLAY SUCCESS AND THE COPY BUTTON
                if (result.success && result.content) {
                    contentOutput.innerHTML = `
                        <button class="btn btn-secondary btn-sm mb-3" onclick="copyContent()">
                            <i class="fas fa-copy me-1"></i> Copy to Clipboard
                        </button>
                        <div id="text-to-copy" style="white-space: pre-wrap; font-size: 0.95rem;">
                            ${result.content}
                        </div>`;
                } else {
                    contentOutput.innerHTML = `<p class="text-danger">üö´ Error from Server: ${result.error || 'Unknown error.'}</p>`;
                }

            } catch (error) {
                // 5. DISPLAY ERROR
                console.error("End-to-end Fetch Error:", error);
                contentOutput.innerHTML = `<p class="text-danger">‚ùå Critical Error: Could not connect to the proxy server at ${SERVER_URL}.</p>`;
            }
        }

        // 6. COPY TO CLIPBOARD FUNCTION
        async function copyContent() {
            try {
                const textToCopy = document.getElementById('text-to-copy').innerText;
                await navigator.clipboard.writeText(textToCopy);
                alert('Content copied successfully!');
            } catch (err) {
                console.error('Failed to copy text:', err);
                alert('Failed to copy. Please manually select and copy the text.');
            }
        }
    </script>

</body>
</html>